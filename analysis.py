https://viewer.diagrams.net/?tags=%7B%7D&lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&title=%E5%87%BA%E8%8D%B7%E4%BD%9C%E6%A5%AD.drawio&dark=auto#R%3Cmxfile%3E%3Cdiagram%20name%3D%22%E3%83%9A%E3%83%BC%E3%82%B81%22%20id%3D%22ITrJYy38PfO7NcaY8mtf%22%3E7V3fd6LIEv5rOGfykByabhp4VKO7e%2B7MPXPPnD27e9%2BIEuMdIy6Sidm%2F%2FjbSrdKNBh2qTJP4IjZQwldFfVXVP3Do4HH9SxYvH76kk2TueO5k7dBbx%2FMId6n4KlpeypaQkLJhms0m8qBdw7fZP4lsdGXr02ySrCoH5mk6z2fLauM4XSyScV5pi7Msfa4edp%2FOq%2F%2B6jKeJ0fBtHM%2FN1j9mk%2FxB3oUX7Np%2FTWbTB%2FXPhEflnsdYHSzvZPUQT9LnvSY6dOggS9O83HpcD5J5AZ7CpTxvdGDv9sKyZJE3OeHx9rfpf%2Fx%2Fzb%2FcrhejKAr5vxd31xE3xUjJq%2FxFgZClT4tJUsghDu0%2FP8zy5NsyHhd7n4XaRdtD%2FjiXu%2B9n8%2FkgnafZ5lw6Gg35sCfaS6k%2F4vmTlCobkixP1nv%2FLK%2F%2BlyR9TPLsRRzysAcwI%2FK85502AldCLMVwVv6UJkeJVFYsbWG6Fb2DS2xIxE5Aj7hhE%2FiE5pfFZrIWh%2FQn6dPdZk8DLOPVsjTq%2B9m6wL8lECPXwDCqQkiU1SoMWQSEIXWhLXDojcho1Bp4HjPR49FRC1Rgtm%2BApdxkYjixY2Ami0mvcI3i1yJdJFXwdki7hyA7jo8vbzZL5nE%2B%2B1G9sD3M%2FCOgyH%2F4ms7EXeyM0tVgpdqDvUqfsnEiz9p3ha8I8jU5eZxNk9yQs1HR9q7P15r3rrTG9IfhXK3pgpC1Rt%2BV1gTc7WhNF4SsNfautEZZS1rTBSFrzX9XWvPDlrSmC0LWGu%2By1sQ1xi97BywLFFeHlRpoMQZhgYZ5KbHZ2WebhC4I2SS2aXKz4N59Pbhf5Vn6PVHhvbSYxhF%2FzxlSJ%2FSc%2FnCzQZ3%2BQG1Ifj8xG%2BBmMhDKO9ymUpohRFDZQPTGwO7jg%2B0xLLDJiXkrONoDfLQpR0O7EZUgon2LjzYL0dD23hjaQ3y0uc7fcGhfhiSPFWb5vKhU3qebSGJ3Efzvp1TtuF5tavU9cQBhy%2FVGjtovtqbyeyPobtsw5E44cHojZ%2Bg7YeD0t3wcSX1GvaqGN7ukGIHunS5atJWXqZrPMAbPNIZI43CX3fgVc6AeVEGUyJpyN8NoI0CNqrjySMO1aaAbGRrSS9bQVT33XemNEX4T6Lo7t7JnyqI%2BwdVep8t7JyevVH%2BaGI002I%2Bmr1SzjPDMp9q8EPTHmr1Rdjao8Kfp2i1ymlLWahkvamXdxePv083dXo%2FLqy1E5lm8WCmEhDx3b9%2B8sOfrSZx9%2F5RN7z6JvxCKcNXXVfld7PF8v%2Fyxv3F1VR9ZyNiAHo0Wyrt4JWCoiy3OCCKY%2BVjquakK9LYPhQ8UQtD2s6VDoXqtLSPabBFIRiKiDIsNEU72RIuIK2%2Bd3rBo6blOn0GrviZ%2BDHlF9SqcVD4MKpWgJw7naKD4Wto6GSJqQqSaDobYeqmyPZTaT7guh1IIhlKjsS2WoETAxgDR9quuF4SJQcHkt19SQoMpOt6F0h5GtDMYgXklv%2F1w%2FFIYwfkk3%2B8OSHAeyd5Y6bUxNe1hZG%2BkpGME55HsjZN0jAA9kr1RkgESmEfi9nIbJUgeidtLbTpGYB6J28tsOkZwHonbS20GSHAeyV5ue20Ea3sY2UttOkZgHilof7DUpTCC80hB%2B1X7i4EE5pECz1qQGEXySIG9dSQdIziPZG%2BsrWME6JHsDbYNkOA8kr3R9msz6trDyN5gW8cIziPZG2vrGAF6JHuDbQMkMI8U2htt%2Bz6SRwrtDbZ1jMA8UmhvrK1jBOeRQnuDbQMkOI9kb7T92pza9jCyN9jWMYLzSPbG2jpGgB7J3mDbAAnOI9kbbfMAyyPZG2zrGIF5pMjeWFvHCM4jRfYG2wZIYB5JTXxrNANpM33mmDBuwFvI%2FSZ%2Fpln%2BkE7TRTwf7lq1%2BUq7Yz6n6VLC%2Fr8kz1%2FkKo3xU55WlZKsZ%2Fmfxek3vvz1196e27WUvPnx4uxPiyon8bx6Q6Y2a6dGAUz2R7DgnpzCoGbRtT%2B2TpuVRVVHAQBeCKljHxsv5sLhhZBFDsDx4nj2hZBQouMFaV9IawwYIH79%2FOnYmjtXZ0FbM%2BFKFYa3i%2B5U59pRHwzaZotlWLgGrBeFVQzB1oAlBMH9gdMrVXcB7%2F4IgvsDp1cdL0D3RxBqa%2BB0QRmefSHU2eCfR4ZnXxek12OrrEHRK3X11TrgoG1UhLKQXvUl1hkDw9BDKFKhZ6%2BMQ1ViSLO1X944vRp46avztIgXQraPn40B2lcXs31I%2B0Jag6eOXo8tq4mVvTKwojNp9voNC%2BnViyJ9CSs4ggVYcAefYCkxFv2Cc4EUgTIQMlgDMTgnSLtAGpRh2lgnqiQmYoA21n6dpDHRHltRGS6P5QZJQIHrNXN5FlKtINbXFmlsEcUulIqZH%2BqIgRXzvE64QRMxuHKeB%2BAG8amWhZg2hlAwvgBikDb2znpkme%2Fq5ghWNPaarV1oIdVyjyBSLcL4T3Cq5VQP8QDdIGtUTXnjVGsiBugGGULlBJw4OMe0sUZpxFt%2FKg3EIG2s%2FZThTffOcs%2BI%2FOColjXKLiykWjOrhSsgi%2BioAw91TY4GVtwTojtAtTWIgRX3PNZ%2BxoFPtTU5GqCNIUwSuwRigDbWfsrwpntqzawWsIDsN8ouLKRa7mkj9eCI1kfINxBy2urIbEAXiLFuP0JGq%2BEF5wAx1vBHyGfx7KsLnRMGXoD29c56aLmCGp5emy2b1CK9Gq98G40GA8wRyEQvJvtqgQ0AdJEM9wRQtXeSlR0j0lNcQb4dTB%2FuR%2FQI3Qd72fB25L7VARDx9PIhJ3CIdWEyTA1iDA4xhEoDPGI%2Bpo0hVBougRigjWHPC7o0W3uuwRJgbE1Jo1jowmzdvwhbCzPHY2vShZlIogHPkzabjm8fYnCeFGPyPTxiPqaNdaFoUYMYoI01yjo6xNb6DGlIrm4%2FP2mfqwcX4eotGyAwdRd6V6k2Jx3Sh3ahb9XAC9CDIgzGhMfLR7MvjDUP8PGCsy%2FFhM0YejVbTOdJL8vS54KpZ5lg31m6KPakT8XNvErYxal%2FyBt3b5jLxCcgfkBI6Pp%2BoA6Ra026NzSIoigQQQsjQcTDwAcn%2BRp6MVJyfY6xDzYamzZbNKBDIRSjiAUPrCUGLOyeYAyx4OF1oXuCYSajXhe6J2oQA6S6LnRPsBDTxrrQPVGDGKCNvbfuCZ8aLAHH1s1WrXmX3RM%2B8%2FDYGmPdG%2FBCqG%2BM4QX0pJ1Y96YGMThPirHgAzxiIaaNdaF7ogYxQBt7b90TXPkhBK7%2B6J44PLg1QmPqLnRPcDX4F8GHdqF7wsAL0IN2oXuCB2j2hbFSBD5ecPbVbJ2Ij%2B6Jakquj8cE7J4AmFjXjOaHfNhrRPOq4T4V17d%2FVfzvp1TtuF5tNNoTBxC2XJenyf1KkFtAX8paLeNFray7ePx9urnb63F5tYXIPIsXK4WQkOfu7ZsXqr2exNn3T9n07pP4C6EJV31dld%2FFns0coOLH%2FsbVVe2lqhk7tDpjR7REe3FOeRdVlERzCZTR%2FHNRkXqQ98xWvYt7W8HQOj3V1JGfMdrBr7%2F%2FM7pefX74b5YPCcvTb3xwLeU2euOe6WTu58lauZhkMZGbt%2BN5vFrNxlVTrtq9ek%2BeejPeX87%2BO%2FPq35On8KLkJhC87vph6FHfi5hX%2Fr30RPzGJWTvAFbuVa6MujcRZZ7PhROjnBbdXrWP1GE%2FdVy7qr%2B69rV8eyr3jxCF%2FIev6WzznCrT4t6NeiG5NAxP0Y%2BSUr4WUZ64s40aWfRGS4C2cxaUrPKNhIasjZ1tb%2F580zsxvGyQY2pavL9P%2BHhseFGxZxJEd65bp9%2FP6imfzH6oh%2Fy3vSd%2Fr7nmyD8bH9lc5udDR54Vz5iM6VUZUxvO47UQztRq%2F8Rg%2BQzth%2BOkXvt3oc%2F8Wu1LiggjudGLJFf0mGyJ3BoVzRsr0xmOCgIK%2Bz%2Bv%2Fg6bKSOnmikFs1OAaSDNyUbanDK%2BkCpzvN3OOlbBjKtahI1xJxw4vVGR%2B4RBkf6c5SsCQwdEU0IQaM4iBNNC8BGnWBOneKGnxxZnxymFLC3mwY5T1DDdD9uzwPaYG94wN9p9gnbssJAbHZaLbpPRh01aY5PFuBBK9mynHZMsxIYHxWJbpAoNPizSAovUe0XOtkEhSF9nFdvu2i%2B6mkVr71B87jv9wOmViwGRopdBxN5R3%2BmPZEsoYwf42NtXKzW2HnufNur%2Bo9%2BhPEIfChi00TFUr5%2BTlh%2F%2B0E%2FJnfoQQUD9tD%2Be%2FwQPFRRFrPDWGYbFomX9AZY%2FCrwWhtPU43niaJrTS4fHetTOKmd5BnyBW4WPsyp6wenWKH5madH1taNXcaMPX9JJUhzxfw%3D%3D%3C%2Fdiagram%3E%3C%2Fmxfile%3E



from imutils import paths
import argparse
import cv2
import os
import numpy as np
import sys

# コマンドライン引数を取得（0番目はスクリプト名）
args = sys.argv
analyzFolder = args[1]


# ap = argparse.ArgumentParser()
# ap.add_argument("-i", "--images", required=True,
#                 help="path to input directory of images")
# ap.add_argument("-t", "--threshold", type=float, default=100.0,
#                 help="focus measures that fall below this value will be considered 'blurry'")
# args = vars(ap.parse_args())

saveFolder = "C:\画像検査AI\画像検査AI"

# OpenCVのLaplacianを利用してエッジを検出する処理をするメソッドを追加

def variance_of_laplacian(image):
    return cv2.Laplacian(image, cv2.CV_64F)


# 検出したエッジのスコアを画像の左上に記述処理をするメソッドを追加

def report_image(image, laplacian, text):
    cv2.putText(image, "{}: {:.2f}".format(text, laplacian.var()), (10, 60),
                cv2.FONT_HERSHEY_SIMPLEX, 2.0, (0, 255, 0), 3)

# スコアを記述した画像を保存する処理を追加
def write_image(file_path, image):
    
    
    dir_file = os.path.split(file_path)
    dir = dir_file[0]
    
    # ディレクトリ部分を / で分割
    dir_parts = dir.split("\\")
    # ディレクトリの○○を取得
    unsouPath = dir_parts[1] +"\\"+ dir_parts[2]
    # ファイル名
    file_name = dir_file[1]
    # 保存ディレクトリ
    report_dir = saveFolder +"\\"+ unsouPath
    
    os.makedirs(report_dir, exist_ok=True)
    save_path = os.path.join(report_dir, file_name)
    # 日本語パス対応で保存
    ext = os.path.splitext(file_name)[1].lower()
    if ext in [".jpg", ".jpeg"]:
        is_success, buf = cv2.imencode(".jpg", image)
    elif ext == ".png":
        is_success, buf = cv2.imencode(".png", image)
    else:
        is_success, buf = cv2.imencode(".jpg", image)
    if is_success:
        buf.tofile(save_path)
    

# メインの処理を追加。ここでは引数のimagesで渡されたディレクトリに格納されている画像を次々に処理していきます。
# Laplacianのスコアが100以下であれば、ピンボケ写真と判断しています。

# for image_path in paths.list_images(args["images"]):C:\画像検査AI\images
for image_path in paths.list_images("G:\マイドライブ\画像"):
    # image = cv2.imread(image_path)
    
     # フォルダ名に「岡部」が含まれているか判定
    dir_name = os.path.dirname(image_path)
    if "画像" in dir_name:
        nparr = np.fromfile(image_path,np.uint8)
        
        image = cv2.imdecode(nparr,cv2.IMREAD_COLOR)
        gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
        laplacian = variance_of_laplacian(gray)
        
        print (laplacian.var())
        if laplacian.var() > 100:
            text = "Not Blurry"
            # if laplacian.var() < args["threshold"]:
            #     text = "Blurry"
            
            report_image(image, laplacian, text)
        
            write_image(image_path, image)
            # write_image(image_path, laplacian, "/laplacian")    
    









